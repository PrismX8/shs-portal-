<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading FMovies...</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: #1a1a2e;
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #333;
        }

        .header h1 {
            margin: 0;
            font-size: 18px;
            color: #fff;
        }

        .main-content {
            flex: 1;
            position: relative;
        }

        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: #fff;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status {
            margin-bottom: 15px;
            font-size: 16px;
        }

        .method {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 20px;
            max-width: 500px;
        }

        .iframe-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #000;
        }

        .fallback-message {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
            display: none;
        }

        .fallback-message h2 {
            margin-bottom: 15px;
            color: #ff6b6b;
        }

        .fallback-message p {
            margin-bottom: 10px;
            max-width: 600px;
        }

        .retry-btn {
            padding: 10px 20px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            transition: background 0.3s;
        }

        .retry-btn:hover {
            background: #ff5252;
        }

        .footer {
            background: #1a1a2e;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            color: #888;
            border-top: 1px solid #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>FMovies Unblocked</h1>
        </div>

        <div class="main-content">
            <div class="loading-screen" id="loadingScreen">
                <div class="spinner"></div>
                <div class="status">Loading FMovies...</div>
                <div class="method" id="method">Trying to bypass network blocking...</div>
                <div class="progress">Attempting multiple connection methods...</div>
            </div>

            <div class="iframe-container">
                <iframe id="moviesFrame" src="about:blank" allowfullscreen></iframe>
            </div>

            <div class="fallback-message" id="fallbackMessage">
                <h2>Connection Blocked</h2>
                <p>Your network is blocking access to FMovies. This could be due to DNS filtering or network restrictions.</p>
                <p><strong>Try these solutions:</strong></p>
                <p>1. Use a different network (mobile hotspot)</p>
                <p>2. Change your DNS to Google (8.8.8.8) or Cloudflare (1.1.1.1)</p>
                <p>3. Use a VPN to bypass restrictions</p>
                <p>4. Try the local mirror instead</p>
                <button class="retry-btn" onclick="retryConnection()">Retry Connection</button>
            </div>
        </div>

        <div class="footer">
            FMovies Unblocked - Attempting to bypass network restrictions
        </div>
    </div>

    <script>
        // List of potential methods to load the site
        // Start with the stealth wrapper first to reduce detection risk on restrictive networks.
        const methods = [
            {
                name: "Stealth Wrapper (about:blank)",
                url: "https://fmoviesto.ru/home",
                stealth: true,
                description: "Hiding the destination inside a blank iframe..."
            },
            {
                name: "Direct Connection",
                url: "https://fmoviesto.ru/home",
                description: "Trying direct connection..."
            },
            {
                name: "Alternative Domain",
                url: "https://fmoviesto.to/home",
                description: "Trying alternative domain..."
            },
            {
                name: "Web Archive",
                url: "https://web.archive.org/web/20230000000000*/https://fmoviesto.ru/home",
                description: "Trying web archive..."
            }
        ];

        let currentMethod = 0;
        const iframe = document.getElementById('moviesFrame');
        const status = document.querySelector('.status');
        const methodDesc = document.getElementById('method');
        const loadingScreen = document.getElementById('loadingScreen');
        const fallbackMessage = document.getElementById('fallbackMessage');

        function injectStealth(url) {
            // Use srcdoc to avoid exposing the destination in the parent iframe URL.
            const nonce = Math.random().toString(36).slice(2);
            const doc = `
                <!doctype html>
                <html>
                <head>
                  <meta charset="utf-8">
                  <meta name="referrer" content="no-referrer">
                  <style>html,body{margin:0;height:100%;background:#000;}iframe{border:0;width:100%;height:100%;display:block;background:#000;}</style>
                </head>
                <body>
                  <iframe id="inner" allowfullscreen referrerpolicy="no-referrer" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-presentation"></iframe>
                  <script>
                    const target = ${JSON.stringify(url)} + (${JSON.stringify(url)}.includes('?') ? '&' : '?') + 'r=${nonce}';
                    const inner = document.getElementById('inner');
                    setTimeout(() => { inner.src = target; }, 80 + Math.random()*120);
                  <\/script>
                </body>
                </html>
            `;
            iframe.removeAttribute('src');
            iframe.srcdoc = doc;
        }

        function tryNextMethod() {
            if (currentMethod >= methods.length) {
                // All methods failed
                loadingScreen.style.display = 'none';
                fallbackMessage.style.display = 'flex';
                return;
            }

            const method = methods[currentMethod];
            status.textContent = `Attempt ${currentMethod + 1} of ${methods.length}`;
            methodDesc.textContent = method.description;

            // Try to load the URL (with randomized cache-buster). For stealth, embed via srcdoc and nested iframe.
            const cacheBuster = 'r=' + Math.random().toString(36).slice(2);
            if (method.stealth) {
                injectStealth(method.url);
            } else {
                const urlWithRand = method.url + (method.url.includes('?') ? '&' : '?') + cacheBuster;
                iframe.removeAttribute('srcdoc');
                iframe.src = urlWithRand;
            }

            // Set timeout for failure detection
            setTimeout(() => {
                try {
                    const body = iframe.contentDocument?.body;
                    if (!body || body.innerHTML === '' ||
                        body.innerHTML.includes('blocked') ||
                        body.innerHTML.includes('error')) {
                        currentMethod++;
                        tryNextMethod();
                    }
                } catch (_) {
                    // Cross-origin, assume load success unless an error event fires
                    loadingScreen.style.display = 'none';
                }
            }, 5000 + Math.random()*1500);
        }

        function retryConnection() {
            currentMethod = 0;
            fallbackMessage.style.display = 'none';
            loadingScreen.style.display = 'flex';
            tryNextMethod();
        }

        // Start trying methods
        tryNextMethod();

        // Listen for iframe load errors
        iframe.addEventListener('error', () => {
            currentMethod++;
            tryNextMethod();
        });

        iframe.addEventListener('load', () => {
            // Check if content loaded successfully
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                if (iframeDoc.body.innerHTML && !iframeDoc.body.innerHTML.includes('blocked')) {
                    // Success!
                    loadingScreen.style.display = 'none';
                } else {
                    // Failed, try next method
                    currentMethod++;
                    tryNextMethod();
                }
            } catch (e) {
                // Cross-origin error, assume it worked
                loadingScreen.style.display = 'none';
            }
        });
    </script>
</body>
</html>
